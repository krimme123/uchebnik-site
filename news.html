<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Новости — Uchebnik</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(245,245,245,0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
    }
    .checkbox {
      width: 25px;
      height: 25px;
      border: 2px solid #aaa;
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .checked {
      background: url('data:image/svg+xml;utf8,<svg fill="%2300b300" height="24" viewBox="0 0 24 24" width="24"><path d="M20.285 2.857l-11.428 11.428-5.714-5.714-2.857 2.857 8.571 8.571 14.285-14.285z"/></svg>') center no-repeat;
      background-size: contain;
      border-color: #00b300;
      transform: scale(1.1);
    }
    .status {
      margin-top: 15px;
      font-size: 16px;
      color: #666;
      display: none;
    }
    #captcha-text {
      font-size: 18px;
      margin-bottom: 15px;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
    .error-message {
      text-align: center;
      padding: 40px;
      color: #e53e3e;
      background: #fed7d7;
      border-radius: 8px;
      margin: 20px 0;
    }
  </style>
</head>
<body>

  <div id="overlay">
    <div id="captcha-box">
      <div class="checkbox" id="check"></div>
      <span id="captcha-text">Я не робот</span>
      <div class="status" id="status">Проверка...</div>
    </div>
  </div>

  <header class="site-header">
    <div class="header-inner">
      <a class="logo" href="index.html">Uchebnik</a>
      <button id="burger" class="burger" aria-label="Открыть меню" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
      <nav class="main-nav" id="mainNav">
        <ul>
          <li><a href="index.html">Главная</a></li>
          <li><a href="works.html">Работы</a></li>
          <li><a href="reviews.html">Отзывы</a></li>
          <li><a href="news.html" class="active">Новости</a></li>
          <li><a href="contacts.html">Контакты</a></li>
          <li><a href="login.html">Личный кабинет</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Новости сайта</h1>
    <p>Следите за обновлениями и новыми материалами на нашем сайте.</p>

    <div class="news-grid" id="newsContainer">
      <div class="loading" id="loadingMessage">Загрузка новостей...</div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <p>© 2025 Uchebnik</p>
      <nav class="footer-nav">
        <a href="index.html">Главная</a>
        <a href="works.html">Работы</a>
        <a href="reviews.html">Отзывы</a>
        <a href="news.html">Новости</a>
        <a href="contacts.html">Контакты</a>
      </nav>
    </div>
  </footer>

  <script>
    // Улучшенная загрузка новостей
    async function loadNews() {
      const newsContainer = document.getElementById('newsContainer');
      const loadingMessage = document.getElementById('loadingMessage');
      
      try {
        console.log('Начинаем загрузку новостей...');
        
        // Пробуем загрузить разными способами
        let response;
        try {
          response = await fetch('news-data.json');
        } catch (e) {
          console.log('Первый способ не сработал, пробуем второй...');
          response = await fetch('./news-data.json');
        }
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const newsData = await response.json();
        console.log('Новости загружены:', newsData);
        
        if (!Array.isArray(newsData) || newsData.length === 0) {
          throw new Error('Файл новостей пуст или имеет неверный формат');
        }
        
        displayNews(newsData);
        
      } catch (error) {
        console.error('Ошибка загрузки новостей:', error);
        loadingMessage.innerHTML = `
          <div class="error-message">
            <h3>Не удалось загрузить новости</h3>
            <p>Проверьте:</p>
            <ul style="text-align: left; display: inline-block;">
              <li>Файл news-data.json в той же папке</li>
              <li>Правильность формата JSON</li>
              <li>Консоль браузера (F12) для подробностей</li>
            </ul>
            <p><small>Ошибка: ${error.message}</small></p>
          </div>
        `;
      }
    }

    function displayNews(newsData) {
      const newsContainer = document.getElementById('newsContainer');
      const loadingMessage = document.getElementById('loadingMessage');
      
      // Убираем сообщение о загрузке
      if (loadingMessage) {
        loadingMessage.remove();
      }
      
      // Очищаем контейнер
      newsContainer.innerHTML = '';

      // Сортируем новости по ID (новые сначала)
      const sortedNews = newsData.sort((a, b) => b.id - a.id);
      
      sortedNews.forEach(news => {
        const newsCard = document.createElement('article');
        newsCard.className = 'news-card';
        newsCard.innerHTML = `
          <div class="news-date">${news.date}</div>
          <h3>${news.title}</h3>
          <p>${news.excerpt}</p>
          <a href="news-item.html?id=${news.id}" class="news-link">Читать полностью</a>
        `;
        newsContainer.appendChild(newsCard);
      });
    }

    // Загружаем новости при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
      loadNews();
      
      // Остальной код (бургер-меню, капча, тема)...
      const burger = document.getElementById('burger');
      const nav = document.getElementById('mainNav');
      
      if (burger && nav) {
        burger.addEventListener('click', function(e) {
          e.stopPropagation();
          const isOpen = nav.classList.contains('open');
          
          if (isOpen) {
            nav.classList.remove('open');
            burger.setAttribute('aria-expanded', 'false');
          } else {
            nav.classList.add('open');
            burger.setAttribute('aria-expanded', 'true');
          }
        });

        document.addEventListener('click', function(e) {
          if (!nav.contains(e.target) && !burger.contains(e.target)) {
            nav.classList.remove('open');
            burger.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // Капча
      const overlay = document.getElementById('overlay');
      const box = document.getElementById('check');
      const status = document.getElementById('status');

      if(localStorage.getItem('captchaPassed') === 'true'){
        overlay.style.display = 'none';
      }

      if (box) {
        box.addEventListener('click', () => {
          if (box.classList.contains('checked')) return;
          box.classList.add('checked');
          status.style.display = 'block';
          setTimeout(() => {
            status.innerText = 'Подтверждено!';
            setTimeout(() => {
              overlay.style.opacity = '0';
              setTimeout(() => {
                overlay.style.display = 'none';
                localStorage.setItem('captchaPassed', 'true');
              }, 300);
            }, 1000);
          }, 2000);
        });
      }

      // Переключение темы
      const themeToggle = document.querySelector('.theme-toggle');
      const currentTheme = localStorage.getItem('theme') || 'light';
      
      document.documentElement.setAttribute('data-theme', currentTheme);
      
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'light' ? 'dark' : 'light';
          
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      }
    });
  </script>
</body>
</html>